#!/bin/bash

if [ $(whoami) != "root" ]; then
  echo "Ohne Root-Rechte geht's nicht!"
  exit 1
fi

rm .bashrc
mv .bashrc.backup .bashrc
chown $SUDO_USER:$SUDO_USER .bashrc

while [ -z "$new_pw" ]; do
  new_pw=$( whiptail --passwordbox "Passwort wurde vorhin zurückgesetzt. 
  Hier kannst du einen neuen angeben:" 9 40 3>&1 1>&2 2>&3 )
done
echo -e "$SUDO_USER:$new_pw" | chpasswd

if ( whiptail --yesno "Möchtest du Xfce als grafische Oberfläche installieren?" 9 40 ); then
  echo "Die Installation erfolgt jetzt:"

  sed -i "s/\[all\]/\[all\]\ndtoverlay=vc4-fkms-v3d\ngpu_mem=128/g" /boot/config.txt

  apt-get -y install --no-install-recommends xserver-xorg xinit
  apt-get -y install sddm
  apt-get -y install --no-install-recommends xfce4 xfce4-terminal \
  blackbird-gtk-theme gtk3-engines-xfce tango-icon-theme blueman network-manager-gnome
  apt-get -y install meld mousepad gthumb xfce4-notifyd xfce4-screenshooter
  apt-get -y install thunar-volman gparted xfce4-cpugraph-plugin bluealsa volumeicon-alsa xfce4-taskmanager xarchiver
  apt-get -y install libreoffice-l10n-de libreoffice-writer libreoffice-calc libreoffice-impress
fi

rm /etc/systemd/system/getty@tty1.service.d/autologin.conf
rm base-config file-list gui-installer &&
sleep 4 && reboot
